<script>
let step = 0;
let noClicks = 0;

function setText(t, cb){
  const e = document.getElementById('text');
  e.classList.add('fade');
  setTimeout(()=>{
    e.innerText = t;
    e.classList.remove('fade');
    if(cb) setTimeout(cb, 2500);
  }, 800);
}

function playSound(){
  const a = new Audio('https://www.soundjay.com/buttons/sounds/button-3.mp3');
  a.volume = .2;
  a.play();
}

/* MERAKLI MISIN – HAYIR */
function chooseNo(){
  const no = document.getElementById('no');
  const yes = document.getElementById('yes');
  noClicks++;

  no.style.transition = 'transform .4s, opacity .4s';
  no.style.transform =
    `scale(${1 - noClicks*0.15}) translateX(${Math.random()*200-100}px)`;

  if(noClicks >= 5){
    no.style.opacity = '0';
    setTimeout(()=>no.remove(), 400);
  }
  yes.classList.add('door-grow');
}

/* EVET */
function chooseYes(){
  playSound();
  const y = document.getElementById('yes');
  y.classList.add('pass');
  setTimeout(()=>{
    document.getElementById('doors').innerHTML = '';
    intro();
  },1000);
}

function intro(){
  const a = [
    '1. oyuna hoş geldin',
    'sana birkaç kapı vericez ve onlardan biri seçiceksin',
    'bu seçimler oyunun finalini değiştiricek',
    'kolay gelsin （￣︶￣）↗'
  ];
  if(step < a.length){
    setText(a[step], ()=>{
      step++;
      intro();
    });
  } else {
    round1();
  }
}

function shrinkAndNext(el, fn){
  playSound();
  el.style.transition = 'transform .4s, opacity .4s';
  el.style.transform = 'scale(0.6)';
  el.style.opacity = '0';
  setTimeout(fn, 500);
}

/* 1. TUR */
function round1(){
  document.getElementById('doors').innerHTML = `
    <div class="door" onclick="shrinkAndNext(this, round2)">
      <span>hyunjin</span>
    </div>
    <div class="door" onclick="shrinkAndNext(this, round2)">
      <span>KAYRA</span>
    </div>`;
  setText('kapını seç');
}

/* 2. TUR */
function round2(){
  document.getElementById('doors').innerHTML = `
    <div class="door" onclick="shrinkAndNext(this, round3)">
      <span>okul çıkışı dolaşmak</span>
    </div>
    <div class="door" onclick="shrinkAndNext(this, round3)">
      <span>kaçmak</span>
    </div>`;
  setText('bir seçim daha');
}

/* 3. TUR */
function round3(){
  document.getElementById('doors').innerHTML = `
    <div class="door heart-door" onclick="shrinkAndNext(this, round4)">
      <div class="heart">❤️</div>
    </div>
    <div class="door heart-door" onclick="shrinkAndNext(this, round4)">
      <div class="heart">❤️</div>
    </div>`;
  setText('beni seviyormusun');
}

/* 4. TUR */
function round4(){
  document.getElementById('doors').innerHTML = `
    <div class="door locked" onclick="lockedClick(this)">
      <div class="chain"></div>
      <div class="chain-text">ayrılmak</div>
      <div class="lock-msg">piçsin</div>
    </div>
    <div class="door" onclick="finish()">
      <span>:D</span>
    </div>`;
  setText('son karar');
}

function lockedClick(el){
  const m = el.querySelector('.lock-msg');
  m.classList.add('show');
  setTimeout(()=>m.classList.remove('show'), 1200);
}

/* FİNAL – YAZILAR DEĞİŞMEDİ */
function finish(){
  document.getElementById('doors').innerHTML = '';
  setTimeout(()=>{
    const lines = [
      '2. ayımız kutlu olsun',
      'ne kadar odun olsanda',
      'ne kadar utangaç biri olup sanki beni sevmiyormuş gibi yapsanda',
      'ki bu senin elinde değil biliyorum',
      'seni çok seviyorum ve böyle devam etmesini diliyorum',
      ' tek isteğim bu',
      've bazende senin sevdiğin bir şeyi hem çok kıskanıyorum hemde biraz nefret ediyorum :D',
      'onun kim olduğunu biliyorsun ama merak etme bu ilişkimizi etkilemiyor',
      'sadece söyliyim dedim',
      'neyse bunu yapmakla çok uğraştım güzelmi oldu bilmiyorum ama.......',
      'aması yok.....',
      'ne diğicemi bilemedim',
      'neyse umuyorumki beğenirsin görüşürüz ❤'
    ];

    let i = 0;
    function flow(){
      if(i < lines.length){
        const t = document.getElementById('text');
        t.innerText = lines[i];
        t.style.animation = 'slideDown 2s ease';
        i++;
        setTimeout(flow, 2600);
      }
    }
    flow();
  }, 3500);
}
</script>
